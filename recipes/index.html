<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipes | rcpbx</title>
  <meta name="description" content="">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .loading{text-align:center;padding:4rem 1rem;color:var(--text-muted)}
    .loading::after{content:'';display:block;width:24px;height:24px;margin:1rem auto;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .error{text-align:center;padding:4rem 1rem;color:#c00}
    
    /* Category listing */
    .category-header{padding:2rem 1.5rem 1rem;max-width:var(--max-width);margin:0 auto}
    .category-header h1{font-size:1.75rem;font-weight:700;margin-bottom:0.25rem}
    .category-header p{color:var(--text-muted);font-size:0.9rem}
    .recipe-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem;padding:0 1.5rem 2rem;max-width:var(--max-width);margin:0 auto}
    .recipe-link{display:block;padding:1.25rem;background:var(--card);border:1px solid var(--border);border-radius:6px;text-decoration:none;transition:all 0.15s}
    .recipe-link:hover{border-color:var(--accent);transform:translateY(-2px)}
    .recipe-link h2{font-size:1rem;font-weight:600;color:var(--text);margin-bottom:0.25rem}
    .recipe-link p{font-size:0.85rem;color:var(--text-muted);line-height:1.4}
    .recipe-link .meta{font-family:var(--font-mono);font-size:0.7rem;color:var(--text-dim);margin-top:0.5rem}
    
    /* Chef quote */
    .chef-quote{padding:1rem 1.5rem;border-top:1px solid var(--border);font-style:italic;font-size:0.85rem;color:var(--text-dim);text-align:center}
    .chef-quote .chef-name{font-style:normal;color:var(--text-muted)}
    
    /* Print quote */
    @media print {
      .chef-quote{display:block !important;position:absolute;bottom:0.1in;right:0.15in;left:auto;padding:0 !important;border:none !important;font-size:5pt !important;text-align:right !important;max-width:1.8in}
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a href="../" class="logo-container" tabindex="0">
        <span class="logo-text"><span class="logo-prefix">&gt;</span><span class="logo-char">r</span><span class="logo-vowel v-e1">e</span><span class="logo-char">c</span><span class="logo-vowel v-i">i</span><span class="logo-char">p</span><span class="logo-vowel v-e2">e</span><span class="logo-char">b</span><span class="logo-vowel v-o">o</span><span class="logo-char">x</span></span>
      </a>
      <a href="../reference/" class="header-link">kitchen ref →</a>
    </div>
  </header>
  <main>
    <div id="content"><div class="loading">Loading...</div></div>
  </main>
  <footer class="site-footer"><p class="footer-line"><span style="color:var(--accent);font-weight:500">rcpbx.com</span><span class="sep">·</span><span>$0 VC</span><span class="sep">·</span><span class="never-acquired">never acquired</span></p></footer>
  <button class="print-btn" onclick="window.print()" style="display:none" id="print-btn">Print Card</button>
  <script>
const chefQuotes = [
  {q: "People who love to eat are always the best people.", c: "Julia Child"},
  {q: "A recipe has no soul. You, as the cook, must bring soul to the recipe.", c: "Thomas Keller"},
  {q: "Good food is very often, even most often, simple food.", c: "Anthony Bourdain"},
  {q: "Fat gives things flavor.", c: "Julia Child"},
  {q: "One cannot think well, love well, sleep well, if one has not dined well.", c: "Virginia Woolf"},
  {q: "Tell me what you eat, and I will tell you who you are.", c: "Brillat-Savarin"},
  {q: "First we eat, then we do everything else.", c: "M.F.K. Fisher"},
  {q: "If you are afraid of butter, use cream.", c: "Julia Child"},
  {q: "Cooking is one failure after another, and that's how you finally learn.", c: "Julia Child"},
  {q: "No one is born a great cook, one learns by doing.", c: "Julia Child"},
  {q: "Once you understand the foundations of cooking, you become free.", c: "Thomas Keller"},
  {q: "Store-bought is fine.", c: "Ina Garten"},
  {q: "Don't be a recipe slave.", c: "Alton Brown"},
  {q: "Season as you go.", c: "Jacques Pépin"},
  {q: "Great cooking favors the prepared hands.", c: "Jacques Pépin"},
  {q: "Fat is flavor.", c: "Samin Nosrat"},
  {q: "Never trust a skinny cook.", c: "Italian Proverb"},
  {q: "Mise en place.", c: "Every Chef Ever"}
];
const randomQuote = chefQuotes[Math.floor(Math.random() * chefQuotes.length)];

const params = new URLSearchParams(window.location.search);
const recipeId = params.get('r') || window.location.hash.slice(1) || null;
const categorySlug = params.get('cat') || null;

const categoryNames = {
  'soups-stews': 'Soups & Stews',
  'pasta': 'Pasta',
  'chicken': 'Chicken',
  'beef': 'Beef',
  'pork': 'Pork',
  'seafood': 'Seafood',
  'breakfast': 'Breakfast',
  'sides': 'Sides',
  'baking-dessert': 'Baking & Desserts',
  'basics': 'Basics'
};

if (recipeId) {
  loadRecipe(recipeId);
} else if (categorySlug) {
  loadCategory(categorySlug);
} else {
  document.getElementById('content').innerHTML = '<div class="error">No recipe or category specified. <a href="../">Go home</a></div>';
}

async function loadCategory(slug) {
  const categoryName = categoryNames[slug] || slug;
  document.title = `${categoryName} | rcpbx`;
  
  try {
    // Fetch the recipe index
    const response = await fetch('../data/index.json');
    let recipes;
    
    if (response.ok) {
      const index = await response.json();
      recipes = index.filter(r => r.categorySlug === slug);
    } else {
      // Fallback: load all JSON files (slower)
      recipes = await loadAllRecipes(slug);
    }
    
    if (recipes.length === 0) {
      document.getElementById('content').innerHTML = `<div class="error">No recipes found in ${categoryName}. <a href="../">Go home</a></div>`;
      return;
    }
    
    renderCategoryList(categoryName, recipes);
  } catch (err) {
    console.error(err);
    document.getElementById('content').innerHTML = `<div class="error">Error loading recipes. <a href="../">Go home</a></div>`;
  }
}

async function loadAllRecipes(filterSlug) {
  // Known recipe IDs - we'll try to fetch each one
  const recipeIds = [
    'apple-pie','baby-back-ribs','baked-beans','baked-chicken-breast','baked-cod','baked-potato','baked-ziti',
    'banana-bread','bbq-sauce','bechamel','beef-and-broccoli','beef-barley-soup','beef-fajitas','beef-stew',
    'beef-stroganoff','beef-tacos','biscuits','biscuits-and-gravy','blueberry-muffins','bolognese','breakfast-burrito',
    'breakfast-casserole','broccoli-cheddar-soup','brownies','buffalo-wings','cacio-e-pepe','carbonara','carnitas',
    'carrot-cake','cheesecake','chicken-alfredo','chicken-fried-rice','chicken-marsala','chicken-noodle-soup',
    'chicken-parmesan','chicken-pot-pie','chicken-salad','chicken-stir-fry','chicken-stock','chicken-tacos',
    'chicken-tikka-masala','chicken-tortilla-soup','chili-by-george','chocolate-cake','chocolate-chip-cookies',
    'cinnamon-rolls','coleslaw','cornbread','crab-cakes','dinner-rolls','eggs-benedict','fish-and-chips','fish-tacos',
    'french-onion-soup','french-toast','fried-chicken','glazed-ham','gravy','green-bean-casserole','guacamole',
    'hash-browns','homemade-bread','lasagna','mac-and-cheese','macaroni-salad','marinara-sauce','mashed-potatoes',
    'meatloaf','minestrone','omelette','pan-seared-salmon','pan-seared-steak','pancakes','pasta-primavera',
    'peach-cobbler','philly-cheesesteak','pie-crust','pizza-dough','pork-chops','pork-fried-rice','pork-tenderloin',
    'pot-roast','potato-salad','potato-soup','pound-cake','pulled-pork','pumpkin-pie','quiche','rice-pilaf',
    'roast-chicken','roasted-vegetables','salmon-patties','salsa','scrambled-eggs','shepherds-pie','shrimp-boil',
    'shrimp-scampi','sloppy-joes','smash-burgers','spaghetti-and-meatballs','split-pea-soup','stuffed-shells',
    'stuffing','sugar-cookies','swedish-meatballs','tomato-soup','tuna-noodle-casserole','tuna-salad','vinaigrette',
    'waffles','white-chicken-chili'
  ];
  
  const recipes = [];
  for (const id of recipeIds) {
    try {
      const res = await fetch(`../data/${id}.json`);
      if (res.ok) {
        const recipe = await res.json();
        if (recipe.categorySlug === filterSlug) {
          recipes.push(recipe);
        }
      }
    } catch (e) {}
  }
  return recipes;
}

function renderCategoryList(categoryName, recipes) {
  let html = `
    <div class="category-header">
      <p style="font-family:var(--font-mono);font-size:0.75rem;color:var(--text-dim);margin-bottom:0.5rem"><a href="../" style="color:var(--text-muted);text-decoration:none">Home</a> → ${categoryName}</p>
      <h1>${categoryName}</h1>
      <p>${recipes.length} recipes</p>
    </div>
    <div class="recipe-grid">
  `;
  
  recipes.sort((a, b) => a.title.localeCompare(b.title));
  
  for (const r of recipes) {
    const time = r.time || (r.prep && r.cook ? `${r.prep} + ${r.cook}` : r.prep || r.cook || '');
    html += `
      <a href="?r=${r.id}" class="recipe-link">
        <h2>${r.title}</h2>
        <p>${r.tagline || r.description || ''}</p>
        <div class="meta">${time}${r.serves ? ` · serves ${r.serves}` : ''}${r.makes ? ` · makes ${r.makes}` : ''}</div>
      </a>
    `;
  }
  
  html += '</div>';
  document.getElementById('content').innerHTML = html;
}

async function loadRecipe(id) {
  try {
    const response = await fetch(`../data/${id}.json`);
    if (!response.ok) throw new Error('Recipe not found');
    const recipe = await response.json();
    renderRecipe(recipe);
  } catch (err) {
    document.getElementById('content').innerHTML = `<div class="error">Recipe not found: ${id}. <a href="../">Go home</a></div>`;
  }
}

function renderRecipe(r) {
  document.title = `${r.title} | rcpbx`;
  document.querySelector('meta[name="description"]').content = r.description || r.tagline;
  
  let metaHtml = '';
  if (r.prep) metaHtml += `<div class="meta-item"><span class="meta-label">Prep</span><span class="meta-value">${r.prep}</span></div>`;
  if (r.cook) metaHtml += `<div class="meta-item"><span class="meta-label">Cook</span><span class="meta-value">${r.cook}</span></div>`;
  if (r.time && !r.prep && !r.cook) metaHtml += `<div class="meta-item"><span class="meta-label">Time</span><span class="meta-value">${r.time}</span></div>`;
  if (r.serves) metaHtml += `<div class="meta-item"><span class="meta-label">Serves</span><span class="meta-value">${r.serves}</span></div>`;
  if (r.makes) metaHtml += `<div class="meta-item"><span class="meta-label">Makes</span><span class="meta-value">${r.makes}</span></div>`;
  
  const ingredientsHtml = r.ingredients.map(i => {
    if (typeof i === 'string') return `<li>${i}</li>`;
    if (i.amount) return `<li><span class="amount">${i.amount}</span> ${i.item}</li>`;
    return `<li>${i.item || i}</li>`;
  }).join('');
  
  const stepsHtml = r.steps.map(s => `<li>${s}</li>`).join('');
  const notesHtml = r.notes ? r.notes.map(n => `<p>${n}</p>`).join('') : '';
  
  let sourceHtml = '';
  if (r.source) {
    sourceHtml = `<span>${r.source}</span>`;
    if (r.sourceUrl) sourceHtml += ` <a href="${r.sourceUrl}" target="_blank" rel="noopener">View original →</a>`;
  }
  
  const catLink = r.categorySlug ? `<a href="?cat=${r.categorySlug}" style="color:var(--text-muted);text-decoration:none">${r.category}</a>` : r.category;
  
  document.getElementById('content').innerHTML = `
    <div class="container" style="padding-top:1.5rem">
      <p class="breadcrumb"><a href="../">Home</a> → ${catLink} → ${r.title}</p>
    </div>
    <article class="recipe-card">
      <header class="recipe-header"><h1 class="recipe-title">${r.title}</h1><p class="recipe-tagline">${r.tagline}</p></header>
      <div class="recipe-meta">${metaHtml}</div>
      <div class="recipe-body">
        <section class="ingredients"><h2 class="section-title">Ingredients</h2><ul class="ingredients-list">${ingredientsHtml}</ul></section>
        <section class="steps"><h2 class="section-title">Steps</h2><ol class="steps-list">${stepsHtml}</ol></section>
      </div>
      ${notesHtml ? `<div class="recipe-notes"><h2 class="section-title">Notes</h2>${notesHtml}</div>` : ''}
      ${sourceHtml ? `<footer class="recipe-footer">${sourceHtml}</footer>` : ''}
      <div class="chef-quote">"${randomQuote.q}" <span class="chef-name">—${randomQuote.c}</span></div>
    </article>
  `;
  
  document.getElementById('print-btn').style.display = 'block';
  document.querySelectorAll('.ingredients-list li').forEach(li => {
    li.addEventListener('click', () => li.classList.toggle('checked'));
  });
  document.querySelectorAll('.steps-list li').forEach(li => {
    li.addEventListener('click', () => li.classList.toggle('done'));
  });
}
  </script>
</body>
</html>
